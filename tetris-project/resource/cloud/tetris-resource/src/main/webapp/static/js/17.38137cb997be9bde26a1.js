webpackJsonp([17],{kCLY:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=o("BO1k"),a=o.n(r),l=o("mvHQ"),s=o.n(l),i=o("P9l9"),n={data:function(){return{resources:[],users:[],resourceTableShow:!0,userTableShow:!1,deviceModelOptions:[],filters:{deviceModel:"",keyword:""},multipleSelection:[],disableSetFolderBtn:!0,disableAddFolderBtn:!0,disableModifyFolderBtn:!0,disableDeleteFolderBtn:!0,disableResetRootBtn:!1,defaultExpandKeys:[],tree:[],defaultProps:{children:"children",label:"name"},currentSelectNode:null,expandNodeKeysArr:[],resourceTableLoading:!1,userTableLoading:!1,dialogAddForderFormVisible:!1,dialogmodifyForderFormVisible:!1,folderForm:{},dialogsetRootVisible:!1,setRootId:"",setRootOptions:[],modifyForm:{},toLdapoptions:[{value:!0,label:"是"},{value:!1,label:"否"}]}},methods:{initTree:function(e){var t=this;Object(i.H)().then(function(o){o.errMsg?t.$message({message:o.errMsg,type:"error"}):(t.tree=o.tree,e||(t.expandNodeKeysArr.splice(0,t.expandNodeKeysArr.length),t.expandNodeKeysArr=t.tree.map(function(e){return e.id})),t.defaultExpandKeys=t.expandNodeKeysArr)})},getBundles:function(){var e=this;this.resourceTableShow=!0,this.userTableShow=!1;var t={deviceModel:this.filters.deviceModel,keyword:this.filters.keyword};this.resourceTableLoading=!0,Object(i.O)(t).then(function(t){t.errMsg?e.$message({message:t.errMsg,type:"error"}):e.resources=t.resources,e.resourceTableLoading=!1})},getUsers:function(){var e=this;this.resourceTableShow=!1,this.userTableShow=!0;var t={keyword:this.filters.keyword};this.userTableLoading=!0,Object(i.T)(t).then(function(t){t.errMsg?e.$message({message:t.errMsg,type:"error"}):e.users=t.users,e.userTableLoading=!1})},syncFolderToLdap:function(){var e=this;this.$confirm("是否确认上传LDAP?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e.resourceTableLoading=!0;Object(i._8)({}).then(function(t){e.resourceTableLoading=!1,t.errMsg?e.$message({message:t.errMsg,type:"error"}):(e.$message({message:"同步成功数量："+t.successCnt,type:"success"}),e.initTree(!0))})}).catch(function(){e.$message({type:"info",message:"已取消"})})},downLoadFolderFromLdap:function(){var e=this;this.$confirm("是否确认从LDAP下载?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e.resourceTableLoading=!0;Object(i._7)({}).then(function(t){e.resourceTableLoading=!1,t.errMsg?e.$message({message:t.errMsg,type:"error"}):(e.$message({message:"同步成功数量："+t.successCnt,type:"success"}),e.initTree())})}).catch(function(){e.$message({type:"info",message:"已取消"})})},cleanUpLdap:function(){var e=this;this.$confirm("确认清空所有上传到LDAP和从LDAP下载的信息么？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e.resourceTableLoading=!0;Object(i.i)({}).then(function(t){e.resourceTableLoading=!1,t.errMsg?e.$message({message:t.errMsg,type:"error"}):(e.$message({message:"操作成功",type:"success"}),e.initTree(),e.getBundles())})}).catch(function(){e.$message({type:"info",message:"已取消"})})},showAddFolderDialog:function(){this.dialogAddForderFormVisible=!0,this.folderForm={},this.folderForm.toLdap=!1},addFolder:function(){var e=this;if(this.folderForm.name.length){var t={name:this.folderForm.name,parentId:this.currentSelectNode.id,toLdap:this.folderForm.toLdap};Object(i.b)(t).then(function(t){t.errMsg?e.$message({message:t.errMsg,type:"error"}):(e.initTree(!0),e.dialogAddForderFormVisible=!1)})}else this.$message({message:"请输入分组名称",type:"error"})},showModifyFolderDialog:function(){this.dialogmodifyForderFormVisible=!0,this.modifyForm={name:this.currentSelectNode.name,toLdap:this.currentSelectNode.toLdap}},modifyFolder:function(){var e=this;if(this.modifyForm.name.length){var t={id:this.currentSelectNode.id,name:this.modifyForm.name,toLdap:this.modifyForm.toLdap};Object(i.K)(t).then(function(t){t.errMsg?e.$message({message:t.errMsg,type:"error"}):(e.initTree(!0),e.dialogmodifyForderFormVisible=!1)})}else this.$message({message:"请输入分组名称",type:"error"})},deleteFolder:function(){var e=this;if(this.currentSelectNode.beFolder){var t={id:this.currentSelectNode.id};Object(i.o)(t).then(function(t){t.errMsg?e.$message({message:t.errMsg,type:"error"}):e.initTree(!0)})}else if(this.currentSelectNode.bundleId){var o={bundleIds:this.currentSelectNode.bundleId};Object(i.U)(o).then(function(t){t.errMsg?e.$message({message:t.errMsg,type:"error"}):(e.initTree(!0),e.getBundles())})}else if(this.currentSelectNode.id){var r={userIds:this.currentSelectNode.id};Object(i.V)(r).then(function(t){t.errMsg?e.$message({message:t.errMsg,type:"error"}):(e.initTree(!0),e.getUsers())})}},resetRoot:function(){var e=this;Object(i.W)({}).then(function(t){t.errMsg?e.$message({message:t.errMsg,type:"error"}):e.initTree()})},handleNodeExpand:function(e,t){this.expandNodeKeysArr.push(t.key)},handleNodeCollapse:function(e,t){for(var o=0;o<this.expandNodeKeysArr.length;o++)this.expandNodeKeysArr[o]===t.key&&this.expandNodeKeysArr.splice(o,1)},setFolder:function(){var e=this;if(this.resourceTableShow){var t=this.multipleSelection.map(function(e){return e.bundleId}),o={folderId:this.currentSelectNode.id,bundleIds:t.join(",")};Object(i.Z)(o).then(function(t){t.errMsg?e.$message({message:t.errMsg,type:"error"}):(e.currentSelectNode.children=e.currentSelectNode.children.concat(t.bundleNodes),e.getBundles())})}else if(this.userTableShow){var r=this.multipleSelection,a={folderId:this.currentSelectNode.id,users:s()(r)};Object(i._0)(a).then(function(t){t.errMsg?e.$message({message:t.errMsg,type:"error"}):(e.initTree(!0),e.getUsers())})}},handleSelectionChange:function(e){this.multipleSelection=e,this.multipleSelection.length&&this.currentSelectNode&&this.currentSelectNode.beFolder?this.disableSetFolderBtn=!1:this.disableSetFolderBtn=!0},handleNodeClick:function(e,t,o){this.currentSelectNode=e,e.beFolder?(this.disableAddFolderBtn=!1,this.disableModifyFolderBtn=!1,this.multipleSelection.length&&(this.disableSetFolderBtn=!1),e.children&&e.children.length||e.parentId<0?this.disableDeleteFolderBtn=!0:this.disableDeleteFolderBtn=!1):(this.disableAddFolderBtn=!0,this.disableModifyFolderBtn=!0,this.disableSetFolderBtn=!0,this.disableDeleteFolderBtn=!1)},handleNodeDragEnd:function(e,t,o,r){var a=this;if("none"!==o){var l,s;"FOLDER"===e.data.nodeType?l=e.data.id:"BUNDLE"===e.data.nodeType?l=e.data.bundleId:"USER"===e.data.nodeType&&(l=e.data.username),"FOLDER"===t.data.nodeType?s=t.data.id:"BUNDLE"===t.data.nodeType?s=t.data.bundleId:"USER"===t.data.nodeType&&(s=t.data.username);var n={nodeId:l,changeType:o,nodeType:e.data.nodeType,newTargetId:s,newTargetType:t.data.nodeType,newTargetIndex:t.data.folderIndex,newTargetParentId:t.data.parentId};Object(i.e)(n).then(function(e){e.errMsg&&a.$message({message:e.errMsg,type:"error"}),console.log("change end, initTree"),a.initTree(!0)})}},allowDrop:function(e,t,o){if(e.id===t.id)return!1;if("none"===o)return!1;if(t.data.systemSourceType&&-1===e.data.parentId&&e.data.systemSourceType)return!1;if("ON_DEMAND"===t.data.folderType)return!1;if("FOLDER"!==t.data.nodeType&&(-1!==t.data.parentId&&"ON_DEMAND"===this.$refs.tree.getNode(t.data.parentId).data.folderType))return!1;return"next"!==o&&"prev"!==o||-1!==t.data.parentId},allowDrag:function(e){return"FOLDER"===e.data.nodeType&&(!(-1===e.data.parentId&&!e.data.systemSourceType)&&("ON_DEMAND"!==e.data.folderType&&!!e.data.systemSourceType))},showSetRootDialog:function(){this.dialogsetRootVisible=!0,this.getRootoptions()},getRootoptions:function(){var e=this;this.setRootOptions=[],Object(i.Q)({}).then(function(t){if(t.errMsg)e.$message({message:t.errMsg,type:"error"});else{var o=!0,r=!1,l=void 0;try{for(var s,i=a()(t.rootOptions);!(o=(s=i.next()).done);o=!0){var n=s.value,d={value:n.id,label:n.name};e.setRootOptions.push(d)}}catch(e){r=!0,l=e}finally{try{!o&&i.return&&i.return()}finally{if(r)throw l}}}})},setRoot:function(){var e=this,t={rootId:this.setRootId};Object(i._1)(t).then(function(t){t.errMsg?e.$message({message:t.errMsg,type:"error"}):(e.dialogsetRootVisible=!1,e.initTree())})}},mounted:function(){this.initTree(),this.getBundles()}},d={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("section",[o("el-tabs",{staticStyle:{float:"left",width:"100%"},model:{value:e.activeTabName,callback:function(t){e.activeTabName=t},expression:"activeTabName"}},[o("el-tab-pane",{attrs:{label:"分组管理",name:"分组管理"}})],1),e._v(" "),o("el-card",{staticStyle:{float:"left","margin-top":"10px",width:"45%","font-size":"18px","min-height":"800px"},attrs:{"body-style":"padding:0px"}},[o("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[o("el-button",{staticStyle:{float:"left"},attrs:{type:"primary",size:"small",disabled:e.disableAddFolderBtn},on:{click:e.showAddFolderDialog}},[e._v("添加目录")]),e._v(" "),o("el-button",{staticStyle:{float:"left"},attrs:{type:"primary",size:"small",disabled:e.disableModifyFolderBtn},on:{click:e.showModifyFolderDialog}},[e._v("修改")]),e._v(" "),o("el-button",{staticStyle:{float:"left"},attrs:{type:"danger",size:"small",disabled:e.disableDeleteFolderBtn},on:{click:e.deleteFolder}},[e._v("删除")]),e._v(" "),o("el-button",{staticStyle:{float:"left"},attrs:{type:"danger",size:"small",disabled:e.disableResetRootBtn},on:{click:e.resetRoot}},[e._v("重置根目录")]),e._v(" "),o("el-dropdown",{staticStyle:{float:"left","margin-left":"10px"}},[o("el-button",{attrs:{type:"primary",size:"small"}},[e._v("\n              LDAP操作"),o("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),e._v(" "),o("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[o("el-dropdown-item",{nativeOn:{click:function(t){e.syncFolderToLdap()}}},[e._v("上传到LDAP")]),e._v(" "),o("el-dropdown-item",{nativeOn:{click:function(t){e.downLoadFolderFromLdap()}}},[e._v("从LDAP下载")]),e._v(" "),o("el-dropdown-item",{nativeOn:{click:function(t){e.cleanUpLdap()}}},[e._v("重置LDAP数据")])],1)],1)],1),e._v(" "),o("div",{staticClass:"custom-tree-container"},[o("div",[o("el-tree",{ref:"tree",attrs:{data:e.tree,"node-key":"id","highlight-current":"","expand-on-click-node":!1,props:e.defaultProps,"default-expanded-keys":e.defaultExpandKeys,draggable:"","allow-drop":e.allowDrop,"allow-drag":e.allowDrag},on:{"node-click":e.handleNodeClick,"node-drag-end":e.handleNodeDragEnd,"node-expand":e.handleNodeExpand,"node-collapse":e.handleNodeCollapse}})],1)])]),e._v(" "),o("el-card",{staticStyle:{float:"left","margin-left":"50px","margin-top":"10px",width:"50%","min-height":"800px"},attrs:{"body-style":"padding:0px"}},[o("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[o("el-input",{staticStyle:{float:"left","margin-left":"30px",width:"200px"},attrs:{size:"small",placeholder:"关键字"},model:{value:e.filters.keyword,callback:function(t){e.$set(e.filters,"keyword",t)},expression:"filters.keyword"}}),e._v(" "),o("el-button",{staticStyle:{float:"left","margin-left":"30px"},attrs:{type:"info",size:"small"},on:{click:e.getBundles}},[e._v("查询设备")]),e._v(" "),o("el-button",{staticStyle:{float:"left","margin-left":"30px"},attrs:{type:"info",size:"small"},on:{click:e.getUsers}},[e._v("查询用户")]),e._v(" "),o("el-button",{staticStyle:{float:"right","margin-right":"50px"},attrs:{type:"primary",size:"small",disabled:e.disableSetFolderBtn},on:{click:e.setFolder}},[e._v("加入分组")])],1),e._v(" "),o("el-table",{directives:[{name:"show",rawName:"v-show",value:e.resourceTableShow,expression:"resourceTableShow"},{name:"loading",rawName:"v-loading",value:e.resourceTableLoading,expression:"resourceTableLoading"}],staticStyle:{width:"100%"},attrs:{data:e.resources},on:{"selection-change":e.handleSelectionChange}},[o("el-table-column",{attrs:{width:"50",type:"selection"}}),e._v(" "),o("el-table-column",{attrs:{prop:"bundleName",label:"名称",width:"200",sortable:""}}),e._v(" "),o("el-table-column",{attrs:{prop:"username",label:"账号",width:"200",sortable:""}}),e._v(" "),o("el-table-column",{attrs:{prop:"bundleId",label:"资源ID",width:"300",sortable:""}})],1),e._v(" "),o("el-table",{directives:[{name:"show",rawName:"v-show",value:e.userTableShow,expression:"userTableShow"},{name:"loading",rawName:"v-loading",value:e.userTableLoading,expression:"userTableLoading"}],staticStyle:{width:"100%"},attrs:{data:e.users},on:{"selection-change":e.handleSelectionChange}},[o("el-table-column",{attrs:{width:"50",type:"selection"}}),e._v(" "),o("el-table-column",{attrs:{prop:"name",label:"名称",width:"200",sortable:""}}),e._v(" "),o("el-table-column",{attrs:{prop:"userNo",label:"用户编号",width:"200",sortable:""}}),e._v(" "),o("el-table-column",{attrs:{prop:"creater",label:"创建者",width:"250",sortable:""}})],1)],1),e._v(" "),o("el-dialog",{attrs:{title:"添加分组",visible:e.dialogAddForderFormVisible,width:"30%"},on:{"update:visible":function(t){e.dialogAddForderFormVisible=t}}},[o("el-form",{attrs:{model:e.folderForm,"label-width":"100px"}},[o("el-form-item",{attrs:{label:"分组名称"}},[o("el-input",{staticStyle:{width:"300px"},attrs:{"auto-complete":"off"},model:{value:e.folderForm.name,callback:function(t){e.$set(e.folderForm,"name",t)},expression:"folderForm.name"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"上传LDAP"}},[o("el-select",{attrs:{placeholder:"是否上传LDAP"},model:{value:e.folderForm.toLdap,callback:function(t){e.$set(e.folderForm,"toLdap",t)},expression:"folderForm.toLdap"}},e._l(e.toLdapoptions,function(e){return o("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1)],1),e._v(" "),o("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:function(t){e.dialogAddForderFormVisible=!1}}},[e._v("取 消")]),e._v(" "),o("el-button",{attrs:{type:"primary"},on:{click:e.addFolder}},[e._v("确 定")])],1)],1),e._v(" "),o("el-dialog",{attrs:{title:"修改分组",visible:e.dialogmodifyForderFormVisible,width:"30%"},on:{"update:visible":function(t){e.dialogmodifyForderFormVisible=t}}},[o("el-form",{attrs:{model:e.modifyForm,"label-width":"100px"}},[o("el-form-item",{attrs:{label:"分组名称"}},[o("el-input",{staticStyle:{width:"300px"},attrs:{"auto-complete":"off"},model:{value:e.modifyForm.name,callback:function(t){e.$set(e.modifyForm,"name",t)},expression:"modifyForm.name"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"上传LDAP"}},[o("el-select",{attrs:{placeholder:"是否上传LDAP"},model:{value:e.modifyForm.toLdap,callback:function(t){e.$set(e.modifyForm,"toLdap",t)},expression:"modifyForm.toLdap"}},e._l(e.toLdapoptions,function(e){return o("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1)],1),e._v(" "),o("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:function(t){e.dialogmodifyForderFormVisible=!1}}},[e._v("取 消")]),e._v(" "),o("el-button",{attrs:{type:"primary"},on:{click:e.modifyFolder}},[e._v("确 定")])],1)],1),e._v(" "),o("el-dialog",{attrs:{title:"设置根目录",visible:e.dialogsetRootVisible,width:"30%"},on:{"update:visible":function(t){e.dialogsetRootVisible=t}}},[o("div",{staticStyle:{"margin-top":"10px"}},[o("el-select",{staticStyle:{float:"left","margin-left":"30px",width:"200px"},attrs:{placeholder:"选择根目录"},model:{value:e.setRootId,callback:function(t){e.setRootId=t},expression:"setRootId"}},e._l(e.setRootOptions,function(e){return o("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1),e._v(" "),o("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:function(t){e.dialogsetRootVisible=!1}}},[e._v("取 消")]),e._v(" "),o("el-button",{attrs:{type:"primary"},on:{click:e.setRoot}},[e._v("确 定")])],1)])],1)},staticRenderFns:[]};var c=o("VU/8")(n,d,!1,function(e){o("reLq")},null,null);t.default=c.exports},reLq:function(e,t){}});
//# sourceMappingURL=17.38137cb997be9bde26a1.js.map