webpackJsonp([8],{dLi2:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=s("mvHQ"),a=s.n(l),n=s("BO1k"),i=s.n(n),r=s("P9l9"),o="https://__requestIP__:8743/suma-venus-resource",c={data:function(){return{activeTabName:"BundleManage",resources:[],deviceModelOptions:[],filters:{deviceModel:"",keyword:"",userId:"",sourceType:""},users:[],resourceTableLoading:!1,detailDialogVisible:!1,abilityDetailDialogVisible:!1,setAccessLayerVisible:!1,confirmSyncToLdapVisible:!1,detailInfos:[],channelSchemes:[],total:0,pageNum:1,countPerPage:10,currentRow:{},bundleId:"",newAccessNodeUid:"",uploadUrl:o+"/bundle/import",sourceTypeOptions:[{value:"",label:"全部来源"},{value:"SYSTEM",label:"BVC"},{value:"EXTERNAL",label:"LDAP"}],multipleSelection:[]}},methods:{handleTabClick:function(e,t){"BundleManage"!==e.name&&this.$router.push("/"+e.name)},getAllUsers:function(){var e=this;Object(r.s)().then(function(t){t.errMsg?e.$message({message:t.errMsg,type:"error"}):(e.users=[],e.users.push({id:-1,name:"全部用户"}),e.users=e.users.concat(t.users))})},getDeviceModels:function(){var e=this;Object(r.y)().then(function(t){if(!t.errMsg&&t.deviceModels){e.deviceModelOptions.push({value:"",label:"全部类型"});var s=!0,l=!1,a=void 0;try{for(var n,r=i()(t.deviceModels);!(s=(n=r.next()).done);s=!0){var o=n.value,c={value:o,label:o};e.deviceModelOptions.push(c)}}catch(e){l=!0,a=e}finally{try{!s&&r.return&&r.return()}finally{if(l)throw a}}}})},getResources:function(e){var t=this,s={deviceModel:this.filters.deviceModel,keyword:this.filters.keyword,sourceType:this.filters.sourceType,userId:this.filters.userId,pageNum:e,countPerPage:this.countPerPage};this.resourceTableLoading=!0,Object(r.w)(s).then(function(s){s.errMsg?t.$message({message:s.errMsg,type:"error"}):(t.pageNum=e,t.total=s.total,t.resources=s.resources),t.resourceTableLoading=!1})},handleCurrentPageChange:function(e){this.pageNum=e,this.getResources(this.pageNum)},handleDetail:function(e){var t=this;this.resourceTableLoading=!0;var s={bundleId:e.bundleId};Object(r.v)(s).then(function(s){s.errMsg?t.$message({message:s.errMsg,type:"error"}):(t.detailDialogVisible=!0,t.detailInfos=s.extraInfos,t.detailInfos.push({name:"bundle_id",value:e.bundleId})),t.resourceTableLoading=!1})},handleModify:function(e){console.log(a()(e)),this.$router.push({path:"/ModifyBundle",query:{bundleId:e.bundleId,bundleName:e.bundleName,deviceIp:e.deviceAddr.deviceIp,devicePort:e.deviceAddr.devicePort}})},handleLogout:function(e){var t=this;this.resourceTableLoading=!0;var s={bundleId:e.bundleId};Object(r.I)(s).then(function(s){s.errMsg?t.$message({message:s.errMsg,type:"error"}):(e.onlineStatus="OFFLINE",t.$message({message:"踢出账号成功",type:"success"})),t.resourceTableLoading=!1})},handleClear:function(e){var t=this;this.$confirm("重置资源将会清空资源上的能力占用，是否确认?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.resourceTableLoading=!0;var s={bundleId:e.bundleId};Object(r.j)(s).then(function(e){e.errMsg?t.$message({message:e.errMsg,type:"error"}):t.$message({message:"重置成功",type:"success"}),t.resourceTableLoading=!1})}).catch(function(){t.$message({type:"info",message:"已取消重置"})})},handleDelete:function(e){var t=this;this.$confirm("是否确认删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.resourceTableLoading=!0;var s={bundleIds:e.bundleId};Object(r.n)(s).then(function(e){t.resourceTableLoading=!1,e.errMsg?t.$message({message:e.errMsg,type:"error"}):(t.$message({message:"删除成功",type:"success"}),t.getResources(1))})}).catch(function(){t.$message({type:"info",message:"已取消删除"})})},abilityConfig:function(e){this.$router.push({path:"/ConfigBundle",query:{bundleId:e.bundleId}})},abilityDetail:function(e){var t=this,s={bundleId:e.bundleId};this.resourceTableLoading=!0,Object(r.u)(s).then(function(e){e.errMsg?t.$message({message:e.errMsg,type:"error"}):(t.abilityDetailDialogVisible=!0,t.channelSchemes=e.channelSchemes),t.resourceTableLoading=!1})},handleSetLayerId:function(e){this.currentRow=e,this.bundleId=e.bundleId,this.newAccessNodeUid=e.accessNodeUid,this.setAccessLayerVisible=!0},submitSetAccessLayer:function(){var e=this,t={bundleId:this.bundleId,accessLayerId:this.newAccessNodeUid};Object(r.Y)(t).then(function(t){t.errMsg?e.$message({message:t.errMsg,type:"error"}):(e.currentRow.accessNodeUid=e.newAccessNodeUid,e.$message({message:"设置接入成功",type:"success"})),e.setAccessLayerVisible=!1})},showMultiSetAccessLayerDialog:function(){if(this.multipleSelection.length){var e=[],t=!0,s=!1,l=void 0;try{for(var a,n=i()(this.multipleSelection);!(t=(a=n.next()).done);t=!0){var r=a.value;e.push(r.bundleId)}}catch(e){s=!0,l=e}finally{try{!t&&n.return&&n.return()}finally{if(s)throw l}}this.bundleId=e.join(","),console.log("bundleIds=="+this.bundleId),this.newAccessNodeUid="",this.setAccessLayerVisible=!0}else this.$message({message:"请至少选择一行",type:"warning"})},exportBundle:function(){var e=o+"/bundle/export";if(-1!==e.indexOf("__requestIP__")){var t=document.location.host.split(":")[0];e=e.replace("__requestIP__",t)}location.href=e},uploadSuccess:function(e){e.errMsg?this.$message({message:e.errMsg,type:"error"}):(e.successCnt?this.$message({message:"成功导入的设备数量："+e.successCnt,type:"success"}):this.$message({message:"导入失败",type:"error"}),this.getResources(1))},uploadError:function(e){this.$message({message:"上传文件错误: "+a()(e),type:"error"})},onprogress:function(){this.resourceTableLoading=!0},handleMultiDelete:function(){var e=this;this.multipleSelection.length?this.$confirm("是否确认删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e.resourceTableLoading=!0;var t=[],s=!0,l=!1,a=void 0;try{for(var n,o=i()(e.multipleSelection);!(s=(n=o.next()).done);s=!0){var c=n.value;t.push(c.bundleId)}}catch(e){l=!0,a=e}finally{try{!s&&o.return&&o.return()}finally{if(l)throw a}}var u={bundleIds:t.join(",")};Object(r.n)(u).then(function(t){e.resourceTableLoading=!1,t.errMsg?e.$message({message:t.errMsg,type:"error"}):(e.$message({message:"删除成功",type:"success"}),e.getResources(1))})}).catch(function(){e.$message({type:"info",message:"已取消删除"})}):this.$message({message:"请至少选择一行",type:"warning"})},handleSelectionChange:function(e){this.multipleSelection=e},handleSyncFromLdap:function(){var e=this;this.$confirm("确认将从LDAP服务器同步下载信息么？","提示",{}).then(function(){e.resourceTableLoading=!0;Object(r._6)({}).then(function(t){null!==t.errMsg&&""!==t.errMsg?e.$message({message:t.errMsg,type:"error",duration:3e3}):(e.$message({message:"同步成功, 共下载"+t.successCnt+"条信息",type:"success"}),e.getResources(1))}),e.resourceTableLoading=!1})},showHandleSyncToLdapDialog:function(){this.confirmSyncToLdapVisible=!0},handleSyncToLdap:function(e){var t=this;this.resourceTableLoading=!0;var s={syncAll:e};Object(r._5)(s).then(function(e){null!==e.errMsg&&""!==e.errMsg?t.$message({message:e.errMsg,type:"error",duration:3e3}):(t.$message({message:"同步成功, 共上传"+e.successCnt+"条信息",type:"success"}),t.getResources(1))}),this.resourceTableLoading=!1},handleCleanUpLdap:function(){var e=this;this.$confirm("确认清空所有上传到LDAP和从LDAP下载的信息么？","提示",{}).then(function(){e.resourceTableLoading=!0;Object(r.f)({}).then(function(t){null!==t.errMsg&&""!==t.errMsg?e.$message({message:t.errMsg,type:"error",duration:3e3}):(e.$message({message:"重置成功",type:"success"}),e.getResources(1))}),e.resourceTableLoading=!1})}},mounted:function(){if(this.getDeviceModels(),this.getAllUsers(),this.getResources(1),-1!==this.uploadUrl.indexOf("__requestIP__")){var e=document.location.host.split(":")[0];this.uploadUrl=this.uploadUrl.replace("__requestIP__",e)}}},u={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("section",[s("el-tabs",{staticStyle:{float:"left",width:"100%"},on:{"tab-click":e.handleTabClick},model:{value:e.activeTabName,callback:function(t){e.activeTabName=t},expression:"activeTabName"}},[s("el-tab-pane",{attrs:{label:"资源列表",name:"BundleManage"}}),e._v(" "),s("el-tab-pane",{attrs:{label:"添加资源",name:"AddBundle"}})],1),e._v(" "),s("div",{staticStyle:{float:"left",width:"100%"}},[s("el-select",{staticStyle:{float:"left","margin-left":"5px",width:"180px"},attrs:{size:"small",placeholder:"选择类型"},model:{value:e.filters.deviceModel,callback:function(t){e.$set(e.filters,"deviceModel",t)},expression:"filters.deviceModel"}},e._l(e.deviceModelOptions,function(e){return s("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),e._v(" "),s("el-select",{staticStyle:{float:"left","margin-left":"10px",width:"180px"},attrs:{size:"small",placeholder:"选择来源"},model:{value:e.filters.sourceType,callback:function(t){e.$set(e.filters,"sourceType",t)},expression:"filters.sourceType"}},e._l(e.sourceTypeOptions,function(e){return s("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),e._v(" "),s("el-select",{staticStyle:{float:"left","margin-left":"10px",width:"200px"},attrs:{size:"small",filterable:"",placeholder:"选择用户"},model:{value:e.filters.userId,callback:function(t){e.$set(e.filters,"userId",t)},expression:"filters.userId"}},e._l(e.users,function(e){return s("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),e._v(" "),s("el-input",{staticStyle:{float:"left","margin-left":"15px",width:"200px"},attrs:{size:"small",placeholder:"关键字"},model:{value:e.filters.keyword,callback:function(t){e.$set(e.filters,"keyword",t)},expression:"filters.keyword"}}),e._v(" "),s("el-button",{staticStyle:{float:"left","margin-left":"10px"},attrs:{size:"small"},on:{click:function(t){e.getResources(1)}}},[e._v("查询")]),e._v(" "),s("el-dropdown",{staticStyle:{float:"left","margin-left":"20px"}},[s("el-button",{attrs:{type:"primary",size:"small"}},[e._v("\n            LDAP操作"),s("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),e._v(" "),s("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[s("el-dropdown-item",{nativeOn:{click:function(t){e.showHandleSyncToLdapDialog()}}},[e._v("上传到LDAP")]),e._v(" "),s("el-dropdown-item",{nativeOn:{click:function(t){e.handleSyncFromLdap()}}},[e._v("从LDAP下载")]),e._v(" "),s("el-dropdown-item",{nativeOn:{click:function(t){e.handleCleanUpLdap()}}},[e._v("重置LDAP数据")])],1)],1),e._v(" "),s("el-upload",{staticClass:"upload-demo",staticStyle:{float:"left","margin-left":"10px"},attrs:{action:e.uploadUrl,name:"filePoster","show-file-list":!1,"on-success":e.uploadSuccess,"on-error":e.uploadError,"on-progress":e.onprogress}},[s("el-button",{attrs:{type:"primary",size:"small"}},[e._v("导入")])],1),e._v(" "),s("el-button",{staticStyle:{float:"left","margin-left":"10px"},attrs:{type:"primary",size:"small"},on:{click:e.exportBundle}},[e._v("导出")]),e._v(" "),s("el-button",{staticStyle:{float:"left","margin-left":"10px"},attrs:{type:"primary",size:"small"},on:{click:e.showMultiSetAccessLayerDialog}},[e._v("批量设置接入")]),e._v(" "),s("el-button",{staticStyle:{float:"left","margin-left":"10px"},attrs:{type:"danger",size:"small"},on:{click:e.handleMultiDelete}},[e._v("批量删除")])],1),e._v(" "),s("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.resourceTableLoading,expression:"resourceTableLoading"}],staticStyle:{float:"left",width:"100%","margin-top":"20px"},attrs:{data:e.resources},on:{"selection-change":e.handleSelectionChange}},[s("el-table-column",{attrs:{width:"50",type:"selection"}}),e._v(" "),s("el-table-column",{attrs:{prop:"bundleName",label:"名称",width:"200",sortable:""}}),e._v(" "),s("el-table-column",{attrs:{prop:"deviceModel",label:"类型",width:"120",sortable:""}}),e._v(" "),s("el-table-column",{attrs:{prop:"bundleAlias",label:"别名",width:"130",sortable:""}}),e._v(" "),s("el-table-column",{attrs:{prop:"username",label:"设备账号",width:"200"}}),e._v(" "),s("el-table-column",{attrs:{prop:"accessNodeUid",label:"所属接入层",width:"220",sortable:""}}),e._v(" "),s("el-table-column",{attrs:{width:"100",label:"在线状态"},scopedSlots:e._u([{key:"default",fn:function(e){return["ONLINE"==e.row.onlineStatus?s("div",{staticStyle:{height:"20px",width:"20px","border-radius":"50%","background-color":"#0f0"}}):s("div",{staticStyle:{height:"20px",width:"20px","border-radius":"50%","background-color":"#f00"}})]}}])}),e._v(" "),s("el-table-column",{attrs:{width:"100",label:"锁定状态"},scopedSlots:e._u([{key:"default",fn:function(t){return["IDLE"==t.row.lockStatus?s("div",[e._v("空闲")]):"BUSY"==t.row.lockStatus?s("div",[e._v("锁定")]):e._e()]}}])}),e._v(" "),s("el-table-column",{attrs:{width:"100",label:"来源"},scopedSlots:e._u([{key:"default",fn:function(t){return["EXTERNAL"==t.row.sourceType?s("div",[e._v("LDAP")]):s("div",[e._v("BVC")])]}}])}),e._v(" "),s("el-table-column",{attrs:{label:"操作",width:"250"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-button",{attrs:{type:"text",size:"small"},on:{click:function(s){e.handleDetail(t.row)}}},[e._v("详情")]),e._v(" "),s("el-button",{attrs:{type:"text",size:"small"},on:{click:function(s){e.handleModify(t.row)}}},[e._v("修改")]),e._v(" "),s("el-button",{attrs:{type:"text",size:"small"},on:{click:function(s){e.handleSetLayerId(t.row)}}},[e._v("设置接入")]),e._v(" "),s("el-button",{attrs:{type:"text",size:"small"},on:{click:function(s){e.handleClear(t.row)}}},[e._v("重置")]),e._v(" "),s("el-button",{attrs:{type:"text",size:"small"},on:{click:function(s){e.handleDelete(t.row)}}},[e._v("删除")])]}}])}),e._v(" "),s("el-table-column",{attrs:{label:"能力",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-button",{attrs:{type:"text",size:"small"},on:{click:function(s){e.abilityConfig(t.row)}}},[e._v("配置")]),e._v(" "),s("el-button",{attrs:{type:"text",size:"small"},on:{click:function(s){e.abilityDetail(t.row)}}},[e._v("通道信息")])]}}])})],1),e._v(" "),s("el-col",{staticClass:"toolbar",attrs:{span:24}},[s("el-pagination",{staticStyle:{float:"right"},attrs:{layout:"prev, pager, next","current-page":e.pageNum,"page-size":e.countPerPage,total:e.total},on:{"current-change":e.handleCurrentPageChange}})],1),e._v(" "),s("el-dialog",{attrs:{title:"详情",visible:e.detailDialogVisible,width:"30%"},on:{"update:visible":function(t){e.detailDialogVisible=t}}},[s("ul",e._l(e.detailInfos,function(t){return s("li",[e._v("\n        "+e._s(t.name)+" :  "+e._s(t.value)+"\n      ")])}))]),e._v(" "),s("el-dialog",{attrs:{title:"能力详情",visible:e.abilityDetailDialogVisible,width:"40%"},on:{"update:visible":function(t){e.abilityDetailDialogVisible=t}}},[s("el-table",{attrs:{data:e.channelSchemes}},[s("el-table-column",{attrs:{property:"channelId",label:"通道ID",width:"250"}}),e._v(" "),s("el-table-column",{attrs:{property:"channelName",label:"通道类型",width:"250"}}),e._v(" "),s("el-table-column",{attrs:{width:"150",label:"通道状态"},scopedSlots:e._u([{key:"default",fn:function(t){return["IDLE"==t.row.channelStatus?s("div",[e._v("空闲")]):"BUSY"==t.row.channelStatus?s("div",[e._v("锁定")]):"OFFLINE"==t.row.channelStatus?s("div",[e._v("掉线")]):s("div",[e._v("未知")])]}}])})],1)],1),e._v(" "),s("el-dialog",{attrs:{title:"设置接入",visible:e.setAccessLayerVisible,width:"30%"},on:{"update:visible":function(t){e.setAccessLayerVisible=t}}},[s("div",{staticStyle:{"margin-top":"10px"}},[s("el-input",{staticStyle:{width:"400px"},attrs:{placeholder:"输入接入层ID"},model:{value:e.newAccessNodeUid,callback:function(t){e.newAccessNodeUid=t},expression:"newAccessNodeUid"}},[s("template",{slot:"prepend"},[e._v("接入层ID")])],2)],1),e._v(" "),s("div",{staticStyle:{"margin-top":"30px"}},[s("el-button",{staticStyle:{"margin-left":"150px"},attrs:{type:"primary"},on:{click:function(t){e.submitSetAccessLayer()}}},[e._v("提交")])],1)]),e._v(" "),s("el-dialog",{staticStyle:{"margin-top":"260px"},attrs:{title:"提示",visible:e.confirmSyncToLdapVisible,width:"500px"},on:{"update:visible":function(t){e.confirmSyncToLdapVisible=t}}},[s("div",[e._v("\n        确认上传信息到LDAP服务器上么？\n    ")]),e._v(" "),s("div",{staticStyle:{"margin-top":"40px"}},[s("el-button",{staticStyle:{"margin-left":"130px"},attrs:{size:"small"},on:{click:function(t){e.confirmSyncToLdapVisible=!1}}},[e._v("取 消")]),e._v(" "),s("el-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"primary",size:"small"},on:{click:function(t){e.handleSyncToLdap("false")}}},[e._v("只上传未同步信息")]),e._v(" "),s("el-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"primary",size:"small"},on:{click:function(t){e.handleSyncToLdap("true")}}},[e._v("上传全部信息")])],1)])],1)},staticRenderFns:[]};var d=s("VU/8")(c,u,!1,function(e){s("uJ3R")},null,null);t.default=d.exports},uJ3R:function(e,t){}});
//# sourceMappingURL=8.42c1f4228103a577f916.js.map