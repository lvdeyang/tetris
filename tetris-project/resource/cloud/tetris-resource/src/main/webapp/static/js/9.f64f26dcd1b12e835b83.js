webpackJsonp([9],{BXv7:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=a("nvbp"),r=a.n(l),s=a("BO1k"),i=a.n(s),n=a("P9l9"),o={data:function(){return{activeTabName:"BindVirtualResource",roles:[],currentRoleRow:null,roleTableLoading:!1,resources:[],filters:{keyword:"",bindType:""},bindTypeOptions:[{value:"all",label:"全部"},{value:"binded",label:"已绑定"},{value:"unbinded",label:"未绑定"}],total:0,pageNum:1,countPerPage:10,resourceTableLoading:!1,checkAll:!1,prevChecks:[],checks:[],detailDialogVisible:!1,detailInfos:[]}},methods:{handleTabClick:function(e,t){"BindVirtualResource"!==e.name&&this.$router.push("/"+e.name)},handleRoleTableRowChange:function(e){this.currentRoleRow=e,this.getResources()},handleSelectionChange:function(e){this.checks=e},getRoles:function(){var e=this;this.roleTableLoading=!0,Object(n.r)({}).then(function(t){t.errMsg?e.$message({message:t.errMsg,type:"error"}):e.roles=t.roles,e.roleTableLoading=!1})},getResources:function(){var e=this;this.prevChecks=[],this.checks=[];var t={roleId:this.currentRoleRow.id,bindType:this.filters.bindType,keyword:this.filters.keyword,pageNum:this.pageNum,countPerPage:this.countPerPage};this.resourceTableLoading=!0,Object(n.G)(t).then(function(t){if(t.errMsg)e.$message({message:t.errMsg,type:"error"});else{e.total=t.total,e.resources=t.resources;var a=!0,l=!1,r=void 0;try{for(var s,n=i()(e.resources);!(a=(s=n.next()).done);a=!0){var o=s.value;o.hasPrivilege&&(e.prevChecks.push(o.resourceId),e.checks.push(o.resourceId))}}catch(e){l=!0,r=e}finally{try{!a&&n.return&&n.return()}finally{if(l)throw r}}}e.resourceTableLoading=!1})},renderCheckHeader:function(e,t){var a=this;return e("el-checkbox",r()([{attrs:{value:a.checkAll},on:{input:function(e){a.checkAll=e}}},{directives:[{name:"model",value:a.checkAll}]},{on:{change:this.handleCheckAllChange}}]),["全选"])},handleCheckAllChange:function(e){if(e){var t=!0,a=!1,l=void 0;try{for(var r,s=i()(this.resources);!(t=(r=s.next()).done);t=!0){var n=r.value;this.checks.push(n.resourceId),n.hasPrivilege=!0}}catch(e){a=!0,l=e}finally{try{!t&&s.return&&s.return()}finally{if(a)throw l}}}else{this.checks=[];var o=!0,c=!1,u=void 0;try{for(var h,d=i()(this.resources);!(o=(h=d.next()).done);o=!0){h.value.hasPrivilege=!1}}catch(e){c=!0,u=e}finally{try{!o&&d.return&&d.return()}finally{if(c)throw u}}}},handleCheckChange:function(e){e.hasPrivilege?(this.checks.push(e.resourceId),this.checks.length===this.resources.length&&(this.checkAll=!0)):(this.checks.splice(this.checks.indexOf(e.resourceId),1),this.checkAll=!1)},handleCurrentPageChange:function(e){this.pageNum=e,this.getResources()},handleDetail:function(e){var t=this,a={resourceId:e.resourceId};Object(n.F)(a).then(function(e){e.errMsg?t.$message({message:e.errMsg,type:"error"}):(t.detailDialogVisible=!0,t.detailInfos=e.infos)})},submitPrivilege:function(){var e=this,t={roleId:this.currentRoleRow.id,prevChecks:this.prevChecks.join(","),checks:this.checks.join(",")};this.resourceTableLoading=!0,Object(n._4)(t).then(function(t){t.errMsg?e.$message({message:t.errMsg,type:"error"}):(e.$message({message:"提交成功",type:"success"}),e.prevChecks=[].concat(e.checks)),e.resourceTableLoading=!1})}},mounted:function(){this.getRoles()}},c={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",[a("el-tabs",{staticStyle:{float:"left",width:"100%"},on:{"tab-click":e.handleTabClick},model:{value:e.activeTabName,callback:function(t){e.activeTabName=t},expression:"activeTabName"}},[a("el-tab-pane",{attrs:{label:"绑定设备资源",name:"BindResource"}}),e._v(" "),a("el-tab-pane",{attrs:{label:"绑定虚拟资源",name:"BindVirtualResource"}})],1),e._v(" "),a("el-card",{staticStyle:{float:"left","margin-top":"10px",width:"20%","font-size":"18px"},attrs:{"body-style":"padding:0px"}},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",[e._v("角色")])]),e._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.roleTableLoading,expression:"roleTableLoading"}],ref:"roleTable",staticStyle:{width:"100%"},attrs:{data:e.roles,"highlight-current-row":""},on:{"current-change":e.handleRoleTableRowChange}},[a("el-table-column",{attrs:{prop:"name",label:"角色名",sortable:""}})],1)],1),e._v(" "),a("el-card",{staticStyle:{float:"left","margin-left":"50px","margin-top":"10px",width:"70%"},attrs:{"body-style":"padding:0px"}},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",{staticStyle:{float:"left","font-size":"18px"}},[e._v("业务资源")]),e._v(" "),a("el-select",{staticStyle:{float:"left","margin-left":"100px"},attrs:{size:"small",placeholder:"选择绑定状态"},model:{value:e.filters.bindType,callback:function(t){e.$set(e.filters,"bindType",t)},expression:"filters.bindType"}},e._l(e.bindTypeOptions,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),e._v(" "),a("el-input",{staticStyle:{float:"left","margin-left":"50px",width:"150px"},attrs:{size:"small",placeholder:"关键字"},model:{value:e.filters.keyword,callback:function(t){e.$set(e.filters,"keyword",t)},expression:"filters.keyword"}}),e._v(" "),a("el-button",{staticStyle:{float:"left","margin-left":"50px"},attrs:{size:"small",type:"info"},on:{click:e.getResources}},[e._v("查询")])],1),e._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.resourceTableLoading,expression:"resourceTableLoading"}],staticStyle:{width:"100%"},attrs:{data:e.resources},on:{"selection-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{width:"150","render-header":e.renderCheckHeader},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-checkbox",{on:{change:function(a){e.handleCheckChange(t.row)}},model:{value:t.row.hasPrivilege,callback:function(a){e.$set(t.row,"hasPrivilege",a)},expression:"scope.row.hasPrivilege"}})]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"name",label:"名称",width:"350",sortable:""}}),e._v(" "),a("el-table-column",{attrs:{prop:"resourceId",label:"资源ID",width:"350",sortable:""}}),e._v(" "),a("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){e.handleDetail(t.row)}}},[e._v("详情")])]}}])})],1),e._v(" "),a("el-col",{staticClass:"toolbar",attrs:{span:24}},[a("el-button",{attrs:{type:"primary"},on:{click:e.submitPrivilege}},[e._v("提交")]),e._v(" "),a("el-pagination",{staticStyle:{float:"right"},attrs:{layout:"prev, pager, next","page-size":e.countPerPage,total:e.total},on:{"current-change":e.handleCurrentPageChange}})],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"详情",visible:e.detailDialogVisible},on:{"update:visible":function(t){e.detailDialogVisible=t}}},[a("ul",e._l(e.detailInfos,function(t){return a("li",[e._v("\n          "+e._s(t.attrName)+" :  "+e._s(t.attrValue)+"\n        ")])}))])],1)},staticRenderFns:[]};var u=a("VU/8")(o,c,!1,function(e){a("Jdt4")},null,null);t.default=u.exports},Jdt4:function(e,t){}});
//# sourceMappingURL=9.f64f26dcd1b12e835b83.js.map