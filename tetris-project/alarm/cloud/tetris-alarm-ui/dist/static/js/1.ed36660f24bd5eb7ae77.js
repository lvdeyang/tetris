webpackJsonp([1],{"75Ql":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a("woOf"),l=a.n(r),s=a("mvHQ"),i=a.n(s),o=a("pFYg"),n=a.n(o),c=a("hhm8"),m=a("fzdN"),d=a("P9l9"),u={data:function(){return{filters:{},alarmVOs:[],total:0,page:1,listLoading:!1,sels:[],editFormVisible:!1,editLoading:!1,activeTab:"alarm",tableData:[],alarmLevelOptions:[{value:"INFO",label:"提示"},{value:"MINOR",label:"一般"},{value:"MAJOR",label:"重要"},{value:"CRITICAL",label:"严重"}],lastTimeRange:"",websock:null,editForm:{id:0,name:"",password:"",confirmpassword:"",phone:"",email:"",isAdmin:0,recAlarmPhoneRSS:0,recAlarmEmailRSS:0,description:""},bindRoleVisible:!1,currentUserId:0}},methods:{handleClick:function(e,t){this.queryAlarmList()},queryAlarmList:function(){var e,t,a,r,l=this;switch(this.activeTab){case"alarm":e="UNTREATED",t="NORMAL";break;case"history":e="AUTO_RECOVER,MANUAL_RECOVER,IGNORE",t="NORMAL";break;case"shield":t="BLOCKED"}void 0!=this.filters.lastTimeRange&&(void 0!==n()(this.filters.lastTimeRange[0])&&(a=c.a.formatDate.format(this.filters.lastTimeRange[0],"yyyy-MM-dd hh:mm:ss")),void 0!==n()(this.filters.lastTimeRange[1])&&(r=c.a.formatDate.format(this.filters.lastTimeRange[1],"yyyy-MM-dd hh:mm:ss")));var s={sourceService:this.filters.sourceService,sourceIP:this.filters.sourceIP,alarmCode:this.filters.alarmCode,firstCreateTime:a,lastCreateTime:r,alarmLevel:this.filters.alarmLevelSel,alarmStatusArrString:e,alarmBlockStatus:t,pageIndex:this.page-1,pageSize:20};console.info(i()(s)),this.listLoading=!0,Object(d.l)(s).then(function(e){null!==e.errMsg&&""!==e.errMsg?l.$message({message:e.errMsg,type:"error",duration:3e3}):(console.log(i()(e.alarmVOs)),l.total=e.total,l.alarmVOs=e.alarmVOs),l.listLoading=!1})},handleShowDetail:function(e,t){this.resetForm("editForm"),this.editFormVisible=!0,this.editForm=l()({},t);var a=[];a.push({dataName:"id",dataContent:this.editForm.id}),a.push({dataName:"告警编码",dataContent:this.editForm.alarmCode}),a.push({dataName:"告警名称",dataContent:this.editForm.sourceService}),a.push({dataName:"告警设备",dataContent:this.editForm.alarmDevice}),a.push({dataName:"告警对象",dataContent:this.editForm.alarmObj}),a.push({dataName:"告警级别",dataContent:this.editForm.alarmLevel}),a.push({dataName:"告警次数",dataContent:this.editForm.alarmCount}),a.push({dataName:"最新告警时间",dataContent:c.a.formatDate.formatString(this.editForm.lastCreateTime,"yyyy-MM-dd hh:mm:ss")}),a.push({dataName:"最新告警参数",dataContent:this.editForm.alarmParams}),a.push({dataName:"首次告警时间",dataContent:c.a.formatDate.formatString(this.editForm.firstCreateTime,"yyyy-MM-dd hh:mm:ss")}),a.push({dataName:"解决建议",dataContent:this.editForm.alarmSolution}),a.push({dataName:"来源微服务名称",dataContent:this.editForm.sourceService}),a.push({dataName:"来源微服务IP",dataContent:this.editForm.sourceServiceIP}),this.tableData=a},resetForm:function(e){void 0!=this.$refs[e]&&this.$refs[e].resetFields()},handleIgnore:function(e,t){var a=this,r={id:t.id};Object(d.h)(r).then(function(e){null!==e.errMsg&&""!==e.errMsg?a.$message({message:e.errMsg,type:"error",duration:3e3}):a.queryAlarmList()})},handleRecover:function(e,t){var a=this,r={id:t.id};Object(d.j)(r).then(function(e){null!==e.errMsg&&""!==e.errMsg?a.$message({message:e.errMsg,type:"error",duration:3e3}):a.queryAlarmList()})},handleDel:function(e,t){var a=this,r={id:t.id};Object(d.c)(r).then(function(e){null!==e.errMsg&&""!==e.errMsg?a.$message({message:e.errMsg,type:"error",duration:3e3}):a.queryAlarmList()})},handleShield:function(e,t){var a=this;this.$confirm("确认屏蔽此类告警吗？","提示",{}).then(function(){var e={id:t.id};Object(d.o)(e).then(function(e){null!==e.errMsg&&""!==e.errMsg?a.$message({message:e.errMsg,type:"error",duration:3e3}):a.queryAlarmList()})})},handleUnShield:function(e,t){var a=this;this.$confirm("确认解除此类告警的屏蔽吗？","提示",{}).then(function(){var e={id:t.id};Object(d.p)(e).then(function(e){null!==e.errMsg&&""!==e.errMsg?a.$message({message:e.errMsg,type:"error",duration:3e3}):a.queryAlarmList()})})},dateFormat:function(e,t){return m.a.dateFormat(e,t)},alarmLevelFormat:function(e,t){return m.a.alarmLevelToString(e[t.property])},selsChange:function(e){this.sels=e},handleCurrentChange:function(e){this.page=e,this.queryAlarmList()},batchRemove:function(){},initWebpack:function(){var e,t=document.location.origin;t.startsWith("https")?(console.log("https"),e="wss"+t.substring(5)+"/websocket/alarm"):(console.log("http"),e="ws"+t.substring(4)+"/websocket/alarm"),console.log("wsuri replace="+e),this.websock=new WebSocket(e),this.websock.onopen=this.websocketopen,this.websock.onmessage=this.websocketonmessage,this.websock.onclose=this.websocketclose,this.websock.onerror=this.websocketerror},websocketopen:function(){console.log("WebSocket连接成功")},websocketonmessage:function(e){console.log(e),"new"===e.data&&(this.$notify({title:"警告",type:"warning",position:"bottom-right",message:"有新的告警",duration:3e3}),this.queryAlarmList())},websocketclose:function(){console.log("WebSocket关闭")},websocketerror:function(){console.log("WebSocket连接失败")}},mounted:function(){this.initWebpack(),this.queryAlarmList()}},h={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",[a("el-tabs",{on:{"tab-click":e.handleClick},model:{value:e.activeTab,callback:function(t){e.activeTab=t},expression:"activeTab"}},[a("el-tab-pane",{attrs:{label:"实时告警",name:"alarm"}}),e._v(" "),a("el-tab-pane",{attrs:{label:"历史告警",name:"history"}}),e._v(" "),a("el-tab-pane",{attrs:{label:"已屏蔽告警",name:"shield"}})],1),e._v(" "),a("el-form",{ref:"filters",attrs:{inline:!0,model:e.filters,"label-width":"80px",size:"mini"}},[a("el-col",{staticClass:"toolbar",staticStyle:{"padding-bottom":"0px",margin:"0px"},attrs:{span:24}},[a("el-form-item",{attrs:{label:"来源服务",prop:"sourceService",span:6}},[a("el-input",{model:{value:e.filters.sourceService,callback:function(t){e.$set(e.filters,"sourceService",t)},expression:"filters.sourceService"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"IP地址",prop:"sourceIP",span:6}},[a("el-input",{model:{value:e.filters.sourceIP,callback:function(t){e.$set(e.filters,"sourceIP",t)},expression:"filters.sourceIP"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"告警编号",prop:"alarmCode",span:6}},[a("el-input",{model:{value:e.filters.alarmCode,callback:function(t){e.$set(e.filters,"alarmCode",t)},expression:"filters.alarmCode"}})],1)],1),e._v(" "),a("el-col",{staticClass:"toolbar",staticStyle:{"padding-top":"0px","padding-bottom":"5px",margin:"0px"},attrs:{span:24}},[a("el-form-item",{attrs:{label:"告警级别",prop:"alarmLevelSel",span:6}},[a("el-select",{attrs:{clearable:"",placeholder:"请选择"},model:{value:e.filters.alarmLevelSel,callback:function(t){e.$set(e.filters,"alarmLevelSel",t)},expression:"filters.alarmLevelSel"}},e._l(e.alarmLevelOptions,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:"告警时间",prop:"lastTimeRange",span:12}},[a("el-date-picker",{attrs:{type:"datetimerange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},model:{value:e.filters.lastTimeRange,callback:function(t){e.$set(e.filters,"lastTimeRange",t)},expression:"filters.lastTimeRange"}})],1),e._v(" "),a("el-form-item",{attrs:{span:3}},[a("el-button",{attrs:{type:"primary"},on:{click:e.queryAlarmList}},[e._v("查询")])],1),e._v(" "),a("el-form-item",{attrs:{span:3}},[a("el-button",{on:{click:function(t){e.resetForm("filters")}}},[e._v("重置")])],1)],1)],1),e._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],staticStyle:{width:"100%"},attrs:{data:e.alarmVOs,"highlight-current-row":""},on:{"selection-change":e.selsChange}},[e._e(),e._v(" "),a("el-table-column",{attrs:{prop:"alarmName",label:"告警名称",width:"180"}}),e._v(" "),a("el-table-column",{attrs:{prop:"alarmDevice",label:"告警设备",width:"150"}}),e._v(" "),a("el-table-column",{attrs:{prop:"alarmLevel",label:"级别",width:"80",formatter:e.alarmLevelFormat,sortable:""}}),e._v(" "),a("el-table-column",{attrs:{prop:"sourceService",label:"来源服务",width:"180"}}),e._v(" "),"history"!=e.activeTab?a("el-table-column",{attrs:{prop:"lastCreateTime",label:"最后告警时间",formatter:e.dateFormat,width:"160",sortable:""}}):e._e(),e._v(" "),"history"===e.activeTab?a("el-table-column",{attrs:{prop:"recoverTime",label:"告警恢复时间",formatter:e.dateFormat,width:"160",sortable:""}}):e._e(),e._v(" "),a("el-table-column",{attrs:{prop:"alarmCount",label:"次数",width:"60"}}),e._v(" "),a("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{size:"small"},on:{click:function(a){e.handleShowDetail(t.$index,t.row)}}},[e._v("详情")]),e._v(" "),"alarm"===e.activeTab?a("el-button",{attrs:{size:"small"},on:{click:function(a){e.handleIgnore(t.$index,t.row)}}},[e._v("忽略")]):e._e(),e._v(" "),"alarm"===e.activeTab?a("el-button",{attrs:{size:"small"},on:{click:function(a){e.handleRecover(t.$index,t.row)}}},[e._v("恢复")]):e._e(),e._v(" "),"alarm"===e.activeTab||"history"===e.activeTab?a("el-button",{attrs:{type:"danger",size:"small"},on:{click:function(a){e.handleShield(t.$index,t.row)}}},[e._v("屏蔽")]):e._e(),e._v(" "),"shield"===e.activeTab?a("el-button",{attrs:{type:"small"},on:{click:function(a){e.handleUnShield(t.$index,t.row)}}},[e._v("解除屏蔽")]):e._e(),e._v(" "),"history"===e.activeTab?a("el-button",{attrs:{type:"danger",size:"small"},on:{click:function(a){e.handleDel(t.$index,t.row)}}},[e._v("删除")]):e._e()]}}])})],1),e._v(" "),a("el-col",{staticClass:"toolbar",attrs:{span:24}},[a("el-pagination",{staticStyle:{float:"right"},attrs:{layout:"prev, pager, next","page-size":20,total:e.total},on:{"current-change":e.handleCurrentChange}})],1),e._v(" "),a("el-dialog",{attrs:{title:"告警详情",visible:e.editFormVisible,"close-on-click-modal":!1},on:{"update:visible":function(t){e.editFormVisible=t}}},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData}},[a("el-table-column",{attrs:{prop:"dataName",width:"180"}}),e._v(" "),a("el-table-column",{attrs:{prop:"dataContent",width:"180"}})],1)],1)],1)},staticRenderFns:[]};var p=a("VU/8")(u,h,!1,function(e){a("WV51")},"data-v-3db7de99",null);t.default=p.exports},WV51:function(e,t){},fzdN:function(e,t,a){"use strict";var r=a("mvHQ"),l=a.n(r),s=a("hhm8");t.a={alarmLevelToString:function(e){switch(e){case"INFO":return"信息";case"MINOR":return"一般";case"MAJOR":return"重要";case"CRITICAL":return"严重"}},dateFormat:function(e,t){var a=e[t.property];return console.log("dataString="+a),void 0===a?"":(console.log("dataString="+l()(Date.parse(a))),s.a.formatDate.format(new Date(Date.parse(a)),"yyyy-MM-dd hh:mm:ss"))}}}});
//# sourceMappingURL=1.ed36660f24bd5eb7ae77.js.map